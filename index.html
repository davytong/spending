<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>üí∏ Salary Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body { font-family:"Poppins","KhmerOS",sans-serif; background:#f4f7fb; padding:20px; }
h1 { text-align:center; color:#0d6efd; font-weight:600; margin-bottom:20px; }
.card { border-radius:16px; margin-bottom:15px; }
.fixed { background:#eef2ff; padding:8px; border-radius:8px; margin-bottom:5px; }
.expense { display:flex; justify-content:space-between; background:#f8f9fa; padding:6px 10px; border-radius:8px; margin-bottom:4px; font-size:14px; }
.over-card { border:2px solid #dc3545; background:#ffe6e6; }
.over { color:#dc3545; font-weight:600; }
.progress { height:14px; border-radius:20px; margin-top:5px; }
.lang-btn { position:fixed; top:15px; right:15px; z-index:10; }
.btn-small { font-size:12px; padding:2px 6px; }
#saveBtn { background-color:#28a745; color:white; width:100%; margin-bottom:5px; }
#deleteBtn { background-color:#dc3545; color:white; width:100%; }
</style>
</head>

<body>

<button class="btn btn-outline-primary lang-btn" id="langBtn">·ûÅ·üí·ûò·üÇ·ûö</button>
<h1 id="title"></h1>

<div class="container">
  <div class="row" id="tracker"></div>
</div>

<!-- MODAL -->
<div class="modal fade" id="expModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="modalTitle"></h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input id="expName" class="form-control mb-2" placeholder="Item name" />
        <input id="expCost" type="number" class="form-control mb-2" placeholder="Cost" />
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <button class="btn" id="deleteBtn"></button>
        <button class="btn" id="saveBtn"></button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================= CONFIG ================= */
const SALARY = 320;
const DAILY_MAX = 4;

const i18n = {
  en:{
    title:"Salary Tracker", spent:"Spent", remain:"Remaining", add:"Add", edit:"Edit Expense", needRemain:"Must remain",
    modalName:"Item name", modalCost:"Cost", saveBtn:"Save", deleteBtn:"Delete",
    items:{Food:"Food",Gas:"Gas",House:"House",Saving:"Saving",Oil:"Oil",Other:"Other"},
    daysLeft:"days left"
  },
  km:{
    title:"·ûè·û∂·ûö·û∂·ûÑ·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ·ûî·üí·ûö·û∂·ûÄ·üã·ûÅ·üÇ", spent:"·ûÖ·üÜ·ûé·û∂·ûô", remain:"·ûì·üÖ·ûü·ûõ·üã", add:"·ûî·ûì·üí·ûê·üÇ·ûò", edit:"·ûÄ·üÇ·ûÖ·üÜ·ûé·û∂·ûô", needRemain:"·ûè·üí·ûö·ûº·ûú·ûì·üÖ·ûü·ûõ·üã",
    modalName:"·ûà·üí·ûò·üÑ·üá·ûë·üÜ·ûì·û∑·ûâ", modalCost:"·ûë·ûπ·ûÄ·ûî·üí·ûö·û∂·ûÄ·üã", saveBtn:"·ûö·ûÄ·üí·ûü·û∂·ûë·ûª·ûÄ", deleteBtn:"·ûõ·ûª·ûî",
    items:{Food:"·û¢·û∂·û†·û∂·ûö",Gas:"·ûü·û∂·üÜ·ûÑ",House:"·ûï·üí·ûë·üá",Saving:"·ûü·ûì·üí·ûü·üÜ",Oil:"·ûî·üí·ûö·üÅ·ûÑ",Other:"·ûï·üí·ûü·üÅ·ûÑ·üó"},
    daysLeft:"·ûê·üí·ûÑ·üÉ·ûì·üÖ·ûü·ûõ·üã"
  }
};

let lang = localStorage.getItem("lang") || "en";

/* ================= SALARY CYCLE ================= */
function getSalaryHalfInfo(date=new Date()){
  const d=date.getDate(), m=date.getMonth(), y=date.getFullYear();
  if(d>=5 && d<=20) return { half:"first", end:new Date(y,m,20) };
  return { half:"second", end:new Date(y,m+1,4) };
}

function daysLeft(end,date){
  return Math.floor((end-date)/(1000*60*60*24))+1;
}

/* ================= DATA ================= */
const halves = [
  {key:"first", label:{en:"1st Half (5‚Äì20)",km:"·ûñ·û∂·ûÄ·üã·ûÄ·ûé·üí·ûè·û∂·ûõ·ûë·û∏·ü° (·ü•‚Äì·ü¢·ü†)"}, vars:["Food","Gas","Other"]},
  {key:"second", label:{en:"2nd Half (21‚Äì4)",km:"·ûñ·û∂·ûÄ·üã·ûÄ·ûé·üí·ûè·û∂·ûõ·ûë·û∏·ü¢ (·ü¢·ü°‚Äì·ü§)"}, vars:["Food","Oil","Other"]}
];

const budgets={Food:60,Gas:15,House:70,Saving:60,Oil:15,Other:25};
const key=(h,c)=>`${h}-${c}`;
const load=k=>JSON.parse(localStorage.getItem(k)||"[]");
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
let ctx=null;

/* ================= RENDER ================= */
function render(){
  const t=i18n[lang];
  title.textContent=t.title;
  langBtn.textContent=lang==="en"?"·ûÅ·üí·ûò·üÇ·ûö":"EN";

  tracker.innerHTML="";
  const today=new Date();
  const cycle=getSalaryHalfInfo(today);

  halves.forEach(h=>{
    let html=`<div class="col-md-6 mb-3"><div class="card">
      <div class="card-header bg-primary text-white">${h.label[lang]}</div>
      <div class="card-body">`;

    h.vars.forEach(v=>{
      const list=load(key(h.key,v));
      const spent=list.reduce((a,b)=>a+b.cost,0);
      const remain=budgets[v]-spent;
      const over=remain<0;

      let foodInfo="";
      if(v==="Food" && cycle.half===h.key){
        const left=daysLeft(cycle.end,today);
        foodInfo=`<div class="mt-2 text-muted">
          üìÖ ${left} ${t.daysLeft} | ${t.needRemain}: $${(left*DAILY_MAX).toFixed(2)}
        </div>`;
      }

      // Render list with edit/delete buttons
      let listHTML="";
      list.forEach((e,i)=>{
        listHTML+=`<div class="expense">
          ${e.name} $${e.cost.toFixed(2)}
          <div>
            <button class="btn btn-sm btn-light btn-small" onclick="edit('${h.key}','${v}',${i})">‚úèÔ∏è</button>
          </div>
        </div>`;
      });

      html+=`<div class="card p-2 mb-2 ${over?"over-card":""}">
        <b>${t.items[v]} ($${budgets[v]})</b>
        <button class="btn btn-sm btn-primary float-end btn-small" onclick="add('${h.key}','${v}')">${t.add}</button>
        <div class="${over?"over":""}">${t.spent}: $${spent.toFixed(2)} | ${t.remain}: $${remain.toFixed(2)}</div>
        ${foodInfo}
        ${listHTML}
      </div>`;
    });

    html+=`</div></div></div>`;
    tracker.innerHTML+=html;
  });
}

/* ================= MODAL ACTIONS ================= */
function add(h,c){
  ctx={h,c,i:null};
  expName.value="";
  expCost.value="";
  modalTitle.textContent=i18n[lang].edit;
  deleteBtn.style.display="none";
  new bootstrap.Modal(expModal).show();
}

function edit(h,c,i){
  const list=load(key(h,c));
  ctx={h,c,i};
  expName.value=list[i].name;
  expCost.value=list[i].cost;
  modalTitle.textContent=i18n[lang].edit;
  deleteBtn.style.display="inline-block";
  new bootstrap.Modal(expModal).show();
}

saveBtn.onclick=()=>{
  if(!ctx) return;
  const list=load(key(ctx.h,ctx.c));
  const cost=parseFloat(expCost.value);
  if(isNaN(cost)) return alert("Invalid cost!");
  if(ctx.i===null) list.push({name:expName.value,cost});
  else list[ctx.i]={name:expName.value,cost};
  save(key(ctx.h,ctx.c),list);
  bootstrap.Modal.getInstance(expModal).hide();
  ctx=null; render();
}

deleteBtn.onclick=()=>{
  if(!ctx||ctx.i===null) return;
  const list=load(key(ctx.h,ctx.c));
  list.splice(ctx.i,1);
  save(key(ctx.h,ctx.c),list);
  bootstrap.Modal.getInstance(expModal).hide();
  ctx=null; render();
}

/* ================= LANGUAGE SWITCH ================= */
langBtn.onclick=()=>{
  lang=lang==="en"?"km":"en";
  localStorage.setItem("lang",lang);
  render();
};

/* ================= INIT ================= */
render();
</script>
</body>
</html>