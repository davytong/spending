<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üí∏ Salary Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  font-family:"Poppins","Khmer OS","Khmer OS System",sans-serif;
  background:#f4f7fb;
  padding:20px;
}
h1{
  text-align:center;
  color:#0d6efd;
  font-weight:600;
  margin-bottom:20px;
}
.card{
  border-radius:16px;
  transition:.3s;
}
.card:hover{
  transform:translateY(-3px);
  box-shadow:0 8px 16px rgba(0,0,0,.15);
}
.fixed{
  background:#eef2ff;
  padding:8px;
  border-radius:8px;
  margin-bottom:6px;
  font-weight:500;
}
.expense{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#f8f9fa;
  padding:6px 10px;
  border-radius:8px;
  margin-bottom:4px;
  font-size:14px;
}
.over-card{
  border:2px solid #dc3545;
  background:#ffe6e6;
}
.stat{
  margin-top:6px;
  font-weight:600;
}
.stat.ok{color:#198754;}
.stat.over{color:#dc3545;}
.progress{
  height:12px;
  border-radius:20px;
}
.lang-btn{
  position:fixed;
  top:15px;
  right:15px;
  z-index:10;
}
.subtotal-card{
  background:#fff3cd;
  border:2px solid #ffc107;
  color:#856404;
  font-weight:700;
  text-align:center;
  padding:10px;
  border-radius:14px;
  margin-top:12px;
}
.food-plan{
  background:#eef6ff;
  padding:8px;
  border-radius:10px;
  font-size:14px;
  margin-top:6px;
}
</style>
</head>

<body>

<button class="btn btn-outline-primary lang-btn" id="langBtn">·ûÅ·üí·ûò·üÇ·ûö</button>
<h1 id="title"></h1>

<div class="container">
  <div class="d-flex mb-3">
    <select id="monthSelect" class="form-select w-50"></select>
    <button id="resetMonth" class="btn btn-danger ms-2">Reset ‚Ü∫</button>
  </div>

  <div class="row" id="tracker"></div>

  <div class="card mt-4">
    <div class="card-body text-center fw-bold">
      <span id="spentLabel"></span>: $<span id="grandSpent">0</span> |
      <span id="remainLabel"></span>: $<span id="grandRemain">0</span>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal fade" id="expModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="modalTitle"></h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input id="expName" class="form-control mb-2">
        <div class="input-group mb-2">
          <input id="expCost" type="number" class="form-control">
          <select id="expCurrency" class="form-select">
            <option value="USD">$ USD</option>
            <option value="KHR">·üõ KHR</option>
          </select>
        </div>
        <input id="expDate" type="date" class="form-control">
      </div>
      <div class="modal-footer">
        <button id="deleteBtn" class="btn btn-danger"></button>
        <button id="saveBtn" class="btn btn-success"></button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================= CONFIG ================= */
const SALARY = 320;
const DAILY_MAX = 4;
const EXCHANGE_RATE = 4000;

/* ================= I18N ================= */
const i18n={
en:{
title:"Salary Tracker",spent:"Spent",remain:"Remaining",over:"OVER",
add:"Add",edit:"Edit Expense",saveBtn:"Save",deleteBtn:"Delete",
subtotal:"Subtotal",needRemain:"Must Remain",
items:{Food:"Food",Gas:"Gas",House:"House",Saving:"Saving",Oil:"Oil",Other:"Other"},
modalName:"Item name",modalCost:"Cost",modalDate:"Date"
},
km:{
title:"·ûè·û∂·ûö·û∂·ûÑ·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ·ûî·üí·ûö·û∂·ûÄ·üã·ûÅ·üÇ",spent:"·ûÖ·üÜ·ûé·û∂·ûô",remain:"·ûì·üÖ·ûü·ûõ·üã",over:"·ûõ·ûæ·ûü",
add:"·ûî·ûì·üí·ûê·üÇ·ûò",edit:"·ûÄ·üÇ·ûÖ·üÜ·ûé·û∂·ûô",saveBtn:"·ûö·ûÄ·üí·ûü·û∂·ûë·ûª·ûÄ",deleteBtn:"·ûõ·ûª·ûî",
subtotal:"·ûü·ûö·ûª·ûî",needRemain:"·ûè·üí·ûö·ûº·ûú·ûì·üÖ·ûü·ûõ·üã",
items:{Food:"·û¢·û∂·û†·û∂·ûö",Gas:"·ûü·û∂·üÜ·ûÑ",House:"·ûï·üí·ûë·üá",Saving:"·ûü·ûì·üí·ûü·üÜ",Oil:"·ûî·üí·ûö·üÅ·ûÑ·ûò·üâ·ûº·ûè·ûº",Other:"·ûï·üí·ûü·üÅ·ûÑ·üó"},
modalName:"·ûà·üí·ûò·üÑ·üá·ûë·üÜ·ûì·û∑·ûâ",modalCost:"·ûë·ûπ·ûÄ·ûî·üí·ûö·û∂·ûÄ·üã",modalDate:"·ûÄ·û∂·ûõ·ûî·ûö·û∑·ûÖ·üí·ûÜ·üÅ·ûë"
}
};

let lang=localStorage.getItem("lang")||"en";

/* ================= DATA ================= */
const halves=[
{key:"first",fixed:["Saving"],vars:["Food","Gas","Other"]},
{key:"second",fixed:["House"],vars:["Food","Oil","Other"]}
];
const budgets={Food:60,Gas:15,House:70,Saving:60,Oil:15,Other:25};

/* ================= HELPERS ================= */
const key=(h,c)=>`${monthSelect.value}-${h}-${c}`;
const load=k=>JSON.parse(localStorage.getItem(k)||"[]");
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));

function getSalaryHalfInfo(d=new Date()){
  const day=d.getDate(),m=d.getMonth(),y=d.getFullYear();
  if(day>=5&&day<=20) return{half:"first",daysLeft:20-day+1};
  const end=day>20?new Date(y,m+1,4):new Date(y,m,4);
  return{half:"second",daysLeft:Math.floor((end-d)/86400000)+1};
}

/* ================= RENDER ================= */
function render(){
const t=i18n[lang];
title.textContent=t.title;
spentLabel.textContent=t.spent;
remainLabel.textContent=t.remain;
langBtn.textContent=lang==="en"?"·ûÅ·üí·ûò·üÇ·ûö":"EN";
resetMonth.textContent=t.resetMonth||"Reset ‚Ü∫";

tracker.innerHTML="";
let grand=0;
const todayInfo=getSalaryHalfInfo();

halves.forEach(h=>{
let halfTotal=0;
let html=`<div class="col-md-6 mb-3"><div class="card"><div class="card-header bg-primary text-white">
${h.key==="first"?"1st Half (5‚Äì20)":"2nd Half (21‚Äì4)"}
</div><div class="card-body">`;

h.fixed.forEach(f=>{
if(load(key(h.key,f)).length) halfTotal+=budgets[f];
html+=`<div class="fixed">${t.items[f]} $${budgets[f]}</div>`;
});

h.vars.forEach(v=>{
const list=load(key(h.key,v));
const spent=list.reduce((a,b)=>a+b.cost,0);
const remain=budgets[v]-spent;
halfTotal+=spent;
const over=remain<0;

let items="";
list.forEach((e,i)=>{
items+=`<div class="expense">${e.date} | ${e.name} $${e.cost.toFixed(2)}
<button class="btn btn-sm btn-light" onclick="edit('${h.key}','${v}',${i})">‚úèÔ∏è</button>
</div>`;
});

let foodPlan="";
if(v==="Food"&&todayInfo.half===h.key){
const must=(todayInfo.daysLeft*DAILY_MAX).toFixed(2);
foodPlan=`<div class="food-plan">
<b>${t.needRemain}:</b> $${must}<br>
üìÖ ${lang==="en"?todayInfo.daysLeft+" days left":"·ûì·üÖ·ûü·ûõ·üã "+todayInfo.daysLeft+" ·ûê·üí·ûÑ·üÉ·ûë·üÄ·ûè"}
</div>`;
}

html+=`
<div class="card p-2 mb-2 ${over?"over-card":""}">
<b>${t.items[v]} ($${budgets[v]})</b>
<button class="btn btn-sm btn-primary float-end" onclick="add('${h.key}','${v}')">${t.add}</button>
${items}
<div class="stat ${over?"over":"ok"}">
${t.spent}: $${spent.toFixed(2)} |
${over?`${t.over}: $${Math.abs(remain).toFixed(2)}`:`${t.remain}: $${remain.toFixed(2)}`}
</div>
${foodPlan}
<div class="progress">
<div class="progress-bar ${over?"bg-danger":spent/budgets[v]>0.7?"bg-warning":"bg-success"}"
style="width:${Math.min(spent/budgets[v]*100,100)}%"></div>
</div>
</div>`;
});

html+=`<div class="subtotal-card">${t.subtotal}: $${halfTotal.toFixed(2)}</div>`;
html+=`</div></div></div>`;
tracker.innerHTML+=html;
grand+=halfTotal;
});

grandSpent.textContent=grand.toFixed(2);
grandRemain.textContent=(SALARY-grand).toFixed(2);
}

/* ================= ACTIONS ================= */
let ctx=null;
function add(h,c){
ctx={h,c,i:null};
expName.value="";
expCost.value="";
expCurrency.value="USD";
expDate.value=new Date().toISOString().split("T")[0];
modalTitle.textContent=i18n[lang].edit;
new bootstrap.Modal(expModal).show();
}
function edit(h,c,i){
const l=load(key(h,c));
ctx={h,c,i};
expName.value=l[i].name;
expCost.value=l[i].cost;
expCurrency.value="USD";
expDate.value=l[i].date;
modalTitle.textContent=i18n[lang].edit;
new bootstrap.Modal(expModal).show();
}
saveBtn.onclick=()=>{
let cost=+expCost.value;
if(expCurrency.value==="KHR") cost=Math.round(cost/EXCHANGE_RATE*100)/100;
const l=load(key(ctx.h,ctx.c));
ctx.i===null?l.push({name:expName.value,cost,date:expDate.value}):(l[ctx.i]={name:expName.value,cost,date:expDate.value});
save(key(ctx.h,ctx.c),l);
bootstrap.Modal.getInstance(expModal).hide();
render();
};
deleteBtn.onclick=()=>{
if(ctx.i===null) return;
const l=load(key(ctx.h,ctx.c));
l.splice(ctx.i,1);
save(key(ctx.h,ctx.c),l);
bootstrap.Modal.getInstance(expModal).hide();
render();
};
langBtn.onclick=()=>{lang=lang==="en"?"km":"en";localStorage.setItem("lang",lang);render();}
monthSelect.onchange=render;
resetMonth.onclick=()=>{halves.forEach(h=>[...h.fixed,...h.vars].forEach(c=>localStorage.removeItem(key(h.key,c))));render();}

/* ================= INIT ================= */
const y=new Date().getFullYear();
for(let m=1;m<=12;m++)monthSelect.innerHTML+=`<option>${y}-${m}</option>`;
monthSelect.value=`${y}-${new Date().getMonth()+1}`;
render();
</script>
</body>
</html>